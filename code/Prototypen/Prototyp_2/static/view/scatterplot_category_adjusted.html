<!DOCTYPE html>
<html>
<head>
    <title>Scatter Plot </title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="chart-container">
    <canvas id="scatterChart"></canvas>
</div>


<script>
    // Function to fetch amenities data and create a scatter plot
    function fetchAmenitiesAndCreateScatterPlot(latitude, longitude, distanceKm, category, limit) {
        // Prepare form data
        const formData = new FormData();
        formData.append('latitude', latitude);
        formData.append('longitude', longitude);
        formData.append('distance_km', distanceKm);
        formData.append('category', category);
        formData.append('limit', limit);

        // Fetch request with form data
        fetch('/amenities/get_amenitites_nearby_scatter', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            createScatterPlot(data);
        })
        .catch(error => console.error('Error fetching scatterplot data:', error));
    }

    // Function to create a scatter plot using Chart.js
    function createScatterPlot(data) {
        // Transform the data to fit Chart.js scatter plot structure
        const scatterData = Object.values(data).map(item => ({
            x: item[1], // distance
            y: item[2] || 0, // y-axis value (category or default to 0)
            name: item[0] // name of the amenity
        }));

        // Get the canvas context
        const ctx = document.getElementById('scatterChart').getContext('2d');
        
        // Create a scatter plot
        const myScatter = new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Amenities distance to university in meters',
                    data: scatterData,
                    backgroundColor: 'rgba(0, 123, 255, 0.5)',
                    pointRadius: 5,
                    pointHoverRadius: 10
                }]
            },
            options: {
                scales: {
                    y: { 
                        beginAtZero: true,
                        min: 0,
                        max: 5,
                        ticks: {
                            stepSize: 1
                        }
                    },
                    x: {
                        beginAtZero: true,
                        min: 0,
                        max: 500,
                        ticks: {
                            stepSize: 100
                        },
                        title: {
                            display: true,
                            text: 'Distance from selected building in meters'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let xValue = context.raw.x.toFixed(2);
                                let name = context.raw.name;
                                return name + ': ' + xValue + ' meters';
                            }
                        }
                    }
                }
            }
        });
    }

    // Extract URL parameters and call the function on page load
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const latitude = urlParams.get('latitude');
        const longitude = urlParams.get('longitude');
        const distanceKm = urlParams.get('distance_km');
        const category = urlParams.get('category');
        const limit = urlParams.get('limit');

        fetchAmenitiesAndCreateScatterPlot(latitude, longitude, distanceKm, category, limit);
    }
</script>


</body>
</html>

