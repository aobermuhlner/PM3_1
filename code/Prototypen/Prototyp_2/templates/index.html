<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map Search</title>
    <!-- Include Leaflet CSS and JavaScript -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

    <style>
        #map { height: 800px; }

        #universityTableBody {
            max-height: 500px;  /* Adjust the height as needed */
            overflow-y: auto;
            display: block; /* Necessary to make tbody scrollable */
        }

    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-12 text-center my-3">
            <h1>University Life Quality Evaluator</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <form id="collegeSelectForm" class="row">
                <label for="collegeSelectDropdown" class="col-sm-1 col-form-label">Select a College:</label>
                <div class="col-sm-11">
                    <select class="form-control" id="collegeSelectDropdown" name="college">
                        {% for college in college_names %}
                            <option value="{{ college }}">{{ college }}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>
        </div>

    </div>
    <div class="row my-4">
        <div class="col-3 border">
                <!-- Type of University -->
                <h4>Colleges</h4>
                <h5>College Type</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="1" id="university">
                    <label class="form-check-label" for="university">University</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="1" id="college">
                    <label class="form-check-label" for="college">College</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="1" id="pedagogical_college">
                    <label class="form-check-label" for="pedagogical_college">Pedagogical College</label>
                </div>

                <!-- Language of state -->
                <h5>Language of state</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="1" id="german">
                    <label class="form-check-label" for="german">German</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="1" id="french">
                    <label class="form-check-label" for="french">French</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="1" id="italian">
                    <label class="form-check-label" for="italian">Italian</label>
                </div>
                <button type="submit" class="btn btn-primary mt-3">Filter Colleges</button>

            <div class="mt-5">
                <h3>Filtered Universities</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">University Name</th>
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody id="universityTableBody">
                        <!-- Rows will be dynamically populated here -->
                    </tbody>
                </table>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const tableBody = document.getElementById('universityTableBody');
                    tableBody.addEventListener('click', function(e) {
                        if (e.target && e.target.classList.contains('delete-row')) {
                            // Remove the corresponding row
                            e.target.closest('tr').remove();
                        }
                    });
                });
            </script>

        </div>
        <div class="col-7">
            <div class="col-12 border">
                <div id="map" class="my-3"></div>
            </div>
        </div>
        <div class="col-2">

            <div class="col-12 border">
                <h4>Amenities</h4>
                <h5>Settings</h5>
                <div class="form-group">
                    <label for="customRange1">Distance to College (in kilometers):</label>
                    <input type="range" class="form-control-range" id="distanceSlider" min="1" max="10" value="5">
                    <span id="distanceValue">5 km</span>
                </div>

                <script>
                    // Update the displayed distance value when the slider changes
                    document.getElementById('distanceSlider').addEventListener('input', function() {
                        document.getElementById('distanceValue').textContent = this.value + " km";
                    });
                </script>


                <!-- Food & Drink -->
                <h5>Food & Drink</h5>
                <div class="form-group">
                    <label for="bar">Bar</label>
                    <input type="range" class="form-control-range" min="1" max="5" step="1" id="bar" value="3">
                </div>
                <div class="form-group">
                    <label for="biergarten">Biergarten</label>
                    <input type="range" class="form-control-range" min="1" max="5" step="1" id="biergarten" value="3">
                </div>
                <div class="form-group">
                    <label for="cafe">Cafe</label>
                    <input type="range" class="form-control-range" min="1" max="5" step="1" id="cafe" value="3">
                </div>
                <div class="form-group">
                    <label for="fast_food">Fast Food</label>
                    <input type="range" class="form-control-range" min="1" max="5" step="1" id="fast_food" value="3">
                </div>
                <div class="form-group">
                    <label for="food_court">Food Court</label>
                    <input type="range" class="form-control-range" min="1" max="5" step="1" id="food_court" value="3">
                </div>
                <div class="form-group">
                    <label for="ice_cream">Ice Cream</label>
                    <input type="range" class="form-control-range" min="1" max="5" step="1" id="ice_cream" value="3">
                </div>
                <div class="form-group">
                    <label for="restaurant">Restaurant</label>
                    <input type="range" class="form-control-range" min="1" max="5" step="1" id="restaurant" value="3">
                </div>
                <div class="form-group">
                    <label for="pub">Pub</label>
                    <input type="range" class="form-control-range" min="1" max="5" step="1" id="pub" value="3">
                </div>


                <!-- Entertainment & Culture -->
                <h5>Entertainment & Culture</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="arts_centre" id="arts_centre">
                    <label class="form-check-label" for="arts_centre">Arts Centre</label>
                </div>
                <!-- ... add other checkboxes for this category similarly ... -->

                <!-- Community & Education -->
                <h5>Community & Education</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="community_centre" id="community_centre">
                    <label class="form-check-label" for="community_centre">Community Centre</label>
                </div>
                <!-- ... add other checkboxes for this category similarly ... -->

                <!-- Financial Services -->
                <h5>Financial Services</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="atm" id="atm">
                    <label class="form-check-label" for="atm">ATM</label>
                </div>
                <!-- ... add other checkboxes for this category similarly ... -->

                <!-- Transportation -->
                <h5>Transportation</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="bus_station" id="bus_station">
                    <label class="form-check-label" for="bus_station">Bus Station</label>
                </div>
                <!-- ... add other checkboxes for this category similarly ... -->

                <!-- Health & Safety -->
                <h5>Health & Safety</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="clinic" id="clinic">
                    <label class="form-check-label" for="clinic">Clinic</label>
                </div>
                <!-- ... add other checkboxes for this category similarly ... -->

                <!-- Postal & Communication -->
                <h5>Postal & Communication</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="post_box" id="post_box">
                    <label class="form-check-label" for="post_box">Post Box</label>
                </div>
                <!-- ... add other checkboxes for this category similarly ... -->

            </div>

        </div>
    </div>
</div>




<!-- Bootstrap JS, Popper.js, and jQuery -->

<script src="https://code.jquery.com/jquery-3.6.0.min.js" </script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // Initialize the Leaflet map with Zurich as the starting point
    var map = L.map('map').setView([47.3769, 8.5417], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Add markers to the map for each coordinate
    function addMarkers(coordinates) {
        coordinates.forEach(coord => L.marker([coord.lat, coord.lon]).addTo(map));
    }

    // Fetch amenities based on college name and display markers on map
    function onCollegeSelected(collegeName) {
        fetch('/colleges/nearby_amenities', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ college_name: collegeName })
        })
        .then(response => response.json())
        .then(data => {
            // Clear previous markers from the Leaflet map
            map.eachLayer(layer => {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });

            // Add new markers for each amenity
            data.forEach(amenity => {
                L.marker([amenity.lat, amenity.lon]).addTo(map)
                  .bindPopup(amenity.name);  // Assuming each amenity has a 'name' attribute
            });
        })
        .catch(error => {
            console.error("Error fetching nearby amenities:", error);
        });
    }

    // Event listener for dropdown change
    document.getElementById('collegeSelectDropdown').addEventListener('change', function() {
        onCollegeSelected(this.value);
    });

    // jQuery initialization
    function fetchAllUniqueColleges() {
        fetch('/colleges/get_all_unique_colleges', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                let tableBody = document.getElementById('universityTableBody');
                while (tableBody.firstChild) {
                    tableBody.removeChild(tableBody.firstChild); // Clear previous entries
                }

                data.forEach((college, index) => {
                    let row = tableBody.insertRow();

                    let cellName = row.insertCell(0);
                    let cellDelete = row.insertCell(1);

                    cellName.textContent = college;

                    let deleteButton = document.createElement('button');
                    deleteButton.className = 'btn btn-danger delete-row';
                    deleteButton.setAttribute('data-id', college._id);
                    deleteButton.textContent = 'Delete';
                    deleteButton.addEventListener('click', function() {
                        row.remove();
                    });

                    cellDelete.appendChild(deleteButton);
                });
            })
            .catch(error => {
                console.error("Error fetching unique colleges:", error);
                alert('Error fetching data. Please try again.');
            });
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Fetch unique college names on button click
        let fetchButton = document.querySelector('.btn-primary');
        fetchButton.addEventListener('click', function(e) {
            e.preventDefault();
            fetchAllUniqueColleges();
        });
    });

</script>


</body>
</html>

